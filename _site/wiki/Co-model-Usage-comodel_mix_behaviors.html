
    <!doctype html><html lang="en"><head><meta charset="utf-8"><title>comodel with mixed behaviors</title></head>
    <body>
    <link rel="stylesheet" href="/style.css">
<link rel="stylesheet" href="/w3.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<script src="//connect.facebook.net/en_US/all.js"></script>
<script src="/linkify.min.js"></script>
<script src="/linkify-jquery.min.js"></script>
<script>
  $(document).ready(function(){
	  		$.getJSON('https://graph.facebook.com/238065426321929/feed?access_token=229040647557399|MQKFlFYX7YW25XGj4GUYZ7B1lcY', function(data) {
		var ahtml="";
		for(var i = 0; i < 5; i++) {
			ahtml=ahtml+"<li>"+data["data"][i]["message"]+"</li>";
		}
		ahtml=ahtml+"";
		$("#fbquotes").html(ahtml);
		$("#fbquotes").linkify();
	});
	 
		$.getJSON('https://api.github.com/repos/gama-platform/gama/commits', function(data) {
			var ahtml="";
			for(var i = 0; i < 5; i++) {
				ahtml=ahtml+"<li>"+data[i]["commit"]["message"]+" by "+data[i]["commit"]["author"]["name"]+" <a href='"+data[i]["html_url"]+"'> See more</a></li>";
			}
			ahtml=ahtml+"";
			$("#commitquotes").html(ahtml);
			$("#commitquotes").linkify();
		});
				
				
		$.getJSON('https://api.github.com/repos/gama-platform/gama/issues', function(data) {
			var ahtml="";
			for(var i = 0; i < 5; i++) {
				ahtml=ahtml+"<li>"+data[i]["title"]+" by "+data[i]["user"]["login"]+" <a href='"+data[i]["html_url"]+"'> See more</a></li>";
			}
			ahtml=ahtml+"";
			$("#issuequotes").html(ahtml);
			$("#issuequotes").linkify();
		});
		
		$.getJSON('https://api.rss2json.com/v1/api.json?rss_url=https%3A%2F%2Fgroups.google.com%2Fforum%2Ffeed%2Fgama-platform%2Ftopics%2Frss.xml%3Fnum%3D15', function(data) {
			var ahtml="";
			for(var i = 0; i < 5; i++) {
				ahtml=ahtml+"<li>"+data["items"][i]["title"]+" by "+data["items"][i]["author"]+" <a href='"+data["items"][i]["link"]+"'> See more</a></li>";
			}
			ahtml=ahtml+"";
			$("#googleusersquotes").html(ahtml);
			$("#googleusersquotes").linkify();
			
		});
 });
  
</script>

    <div class="w3-bar w3-white w3-hide-small">
      <a href="/" class="w3-bar-item w3-button"><img src="/images/icon_gama_50.png"></a>
      <a href="/wiki/" class="w3-bar-item w3-button w3-text-blue">Documentation</a>
      <a href="/wiki/Tutorials" class="w3-bar-item w3-button w3-text-blue">Tutorials</a>
      <a href="#" class="w3-bar-item w3-button w3-text-blue">News</a>
      <a href="#" class="w3-bar-item w3-button w3-text-blue">Download</a>
      <a href="#" class="w3-bar-item w3-button w3-text-blue">Contribute</a>
    </div>

    <div class="w3-row-padding w3-padding-64 w3-container">
        <div>
             <div class="w3-quarter" style="width:260px">
		<nav class="w3-bar-block w3-collapse w3-large w3-theme-l5 w3-animate-left w3-small"  style="z-index:3;margin-left:10px" id="mySidebar">
                    <div class="w3-medium w3-text-blue" style="font-weight:bold"><div>
<a href='/wiki/Tutorials'>Tutorials
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/LearnGAMLStepByStep'>Learn GAML Step by Step
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/Introduction'>Introduction
</a><br/>
<a href='/wiki/StartWithGAML'>Start with GAML
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/ModelOrganization'>Organization of a model
</a><br/>
<a href='/wiki/BasicProgrammingConceptsInGAML'>Basic programming concepts in GAML
</a><br/>
    </div>
<a href='/wiki/ManipulateBasicSpecies'>Manipulate basic species
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/GlobalSpecies'>The global species
</a><br/>
<a href='/wiki/RegularSpecies'>Regular species
</a><br/>
<a href='/wiki/DefiningActionsAndBehaviors'>Defining actions and behaviors
</a><br/>
<a href='/wiki/InteractionBetweenAgents'>Interaction between agents
</a><br/>
<a href='/wiki/AttachingSkills'>Attaching Skills
</a><br/>
<a href='/wiki/Inheritance'>Inheritance
</a><br/>
    </div>
<a href='/wiki/DefiningAdvancedSpecies'>Defining advanced species
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/GridSpecies'>Grid Species
</a><br/>
<a href='/wiki/GraphSpecies'>Graph Species
</a><br/>
<a href='/wiki/MirrorSpecies'>Mirror species
</a><br/>
<a href='/wiki/MultiLevelArchitecture'>Multi-level architecture
</a><br/>
    </div>
<a href='/wiki/DefiningGUIExperiment'>Defining GUI Experiment
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/DefiningParameters'>Defining Parameters
</a><br/>
<a href='/wiki/DefiningDisplaysGeneralities'>Defining displays (Generalities)
</a><br/>
<a href='/wiki/DefiningCharts'>Defining Charts
</a><br/>
<a href='/wiki/Defining3DDisplays'>Defining 3D Displays
</a><br/>
<a href='/wiki/DefiningMonitorsAndInspectors'>Defining monitors and inspectors
</a><br/>
<a href='/wiki/DefiningExportFiles'>Defining export files
</a><br/>
<a href='/wiki/DefiningUserInteraction'>Defining user interaction
</a><br/>
    </div>
<a href='/wiki/ExploringModels'>Exploring Models
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/RunSeveralSimulations'>Run Several Simulations
</a><br/>
<a href='/wiki/BatchExperiments'>Defining Batch Experiments
</a><br/>
<a href='/wiki/ExplorationMethods'>Exploration Methods
</a><br/>
    </div>
<a href='/wiki/OptimizingModels'>Optimizing Models
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/RuntimeConcepts'>Runtime Concepts
</a><br/>
OptimizingModelsSelection
    </div>
<a href='/wiki/MultiParadigmModeling'>Multi-Paradigm Modeling
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/ControlArchitecture'>Control Architectures
</a><br/>
<a href='/wiki/Equations'>Using Equations
</a><br/>
    </div>
    </div>
<a href='/wiki/Recipes'>Recipes
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/ManipulateOSMDatas'>Manipulate OSM Datas
</a><br/>
<a href='/wiki/Diffusion'>Implementing diffusion
</a><br/>
<a href='/wiki/UsingDatabase'>Using Database Access
</a><br/>
<a href='/wiki/CallingR'>Calling R
</a><br/>
<a href='/wiki/UsingFIPAACL'>Using FIPA ACL
</a><br/>
<a href='/wiki/GamAnalyzer'>Using GAMAnalyzer
</a><br/>
<a href='/wiki/UsingBDI'>Using BDI
</a><br/>
<a href='/wiki/UsingDrivingSkill'>Advanced Driving Skill
</a><br/>
<a href='/wiki/ManipulateDates'>Manipulate Dates
</a><br/>
<a href='/wiki/ManipulateLight'>Implementing light
</a><br/>
<a href='/wiki/Comodel'>Using Comodel
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
—Headlessmodefordummies
    </div>
    </div>
    </div>
<a href='/wiki/Tutorials'>Tutorials
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/LuneraysFlu'>Luneray's flu
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/LuneraysFlu_step1'>1. Creation of a first basic disease spreading model
</a><br/>
<a href='/wiki/LuneraysFlu_step2'>2. Definition of monitors and chart outputs
</a><br/>
<a href='/wiki/LuneraysFlu_step3'>3. Importation of GIS data
</a><br/>
<a href='/wiki/LuneraysFlu_step4'>4. Use of a graph to constraint the movements of people]
</a><br/>
<a href='/wiki/LuneraysFlu_step5'>5. Definition of 3D displays
</a><br/>
    </div>
<a href='/wiki/IncrementalModel'>Incremental Model
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/IncrementalModel_step1'>1. Simple SI Model
</a><br/>
<a href='/wiki/IncrementalModel_step2'>2. Charts
</a><br/>
<a href='/wiki/IncrementalModel_step3'>3. Integration of GIS Data
</a><br/>
<a href='/wiki/IncrementalModel_step4'>4. Movement on Graph
</a><br/>
<a href='/wiki/IncrementalModel_step5'>5. Visualizing in 3D
</a><br/>
<a href='/wiki/IncrementalModel_step6'>6. Multi-Level
</a><br/>
<a href='/wiki/IncrementalModel_step7'>7. Differential Equations
</a><br/>
    </div>
<a href='/wiki/PredatorPrey'>Predator Prey
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/PredatorPrey_step1'>1. Basic Model
</a><br/>
<a href='/wiki/PredatorPrey_step2'>2. Vegetation Dynamic
</a><br/>
<a href='/wiki/PredatorPrey_step3'>3. Prey Agent Behavior
</a><br/>
<a href='/wiki/PredatorPrey_step4'>4. Inspectors and Monitors
</a><br/>
<a href='/wiki/PredatorPrey_step5'>5. Predator Agent
</a><br/>
<a href='/wiki/PredatorPrey_step6'>6. Breeding
</a><br/>
<a href='/wiki/PredatorPrey_step7'>7. Agent Aspect
</a><br/>
<a href='/wiki/PredatorPrey_step8'>8. Complex Behavior
</a><br/>
<a href='/wiki/PredatorPrey_step9'>9. Stopping condition
</a><br/>
<a href='/wiki/PredatorPrey_step10'>10. Charts
</a><br/>
<a href='/wiki/PredatorPrey_step11'>11. Writing Files
</a><br/>
<a href='/wiki/PredatorPrey_step12'>12. Image loading
</a><br/>
    </div>
<a href='/wiki/RoadTrafficModel'>Road Traffic
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/RoadTrafficModel_step1'>1. Loading of GIS Data
</a><br/>
<a href='/wiki/RoadTrafficModel_step2'>2. People Agents
</a><br/>
<a href='/wiki/RoadTrafficModel_step3'>3. Movement of People
</a><br/>
<a href='/wiki/RoadTrafficModel_step4'>4. Weight for Road Network
</a><br/>
<a href='/wiki/RoadTrafficModel_step5'>5. Dynamic weights
</a><br/>
<a href='/wiki/RoadTrafficModel_step6'>6. Charts
</a><br/>
<a href='/wiki/RoadTrafficModel_step7'>7. Automatic Road Repair
</a><br/>
    </div>
<a href='/wiki/ThreeD'>3D Tutorial
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/ThreeD_step1'>1. Basic Model
</a><br/>
<a href='/wiki/ThreeD_step2'>2. Moving Cells
</a><br/>
<a href='/wiki/ThreeD_step3'>3. Connections
</a><br/>
    </div>
    </div>
    </div>
<a href='/wiki/References'>References
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/PlatformDocumentation'>Platform
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/InstallationAndLaunching'>Installation and Launching
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/Installation'>Installation
</a><br/>
<a href='/wiki/Launching'>Launching GAMA
</a><br/>
<a href='/wiki/Headless'>Headless Mode
</a><br/>
<a href='/wiki/Updating'>Updating GAMA
</a><br/>
<a href='/wiki/InstallingPlugins'>Installing Plugins
</a><br/>
<a href='/wiki/Troubleshooting'>Troubleshooting
</a><br/>
    </div>
<a href='/wiki/WorkspaceProjectsAndModels'>Workspace, Projects and Models
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/NavigatingWorkspace'>Navigating in the Workspace
</a><br/>
<a href='/wiki/ChangingWorkspace'>Changing Workspace
</a><br/>
<a href='/wiki/ImportingModels'>Importing Models
</a><br/>
    </div>
<a href='/wiki/EditingModels'>Editing models
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/GamlEditorGeneralities'>The GAML Editor - Generalities
</a><br/>
<a href='/wiki/GamlEditorToolbar'>The GAML Editor Toolbar
</a><br/>
<a href='/wiki/ValidationOfModels'>Validation of Models
</a><br/>
    </div>
<a href='/wiki/RunningExperiments'>Running Experiments
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/LaunchingExperiments'>Launching Experiments from the User Interface
</a><br/>
<a href='/wiki/ExperimentsUserInterface'>Experiments User Interface
</a><br/>
<a href='/wiki/MenusAndCommands'>Menus and Commands
</a><br/>
<a href='/wiki/ParametersView'>Parameters View
</a><br/>
<a href='/wiki/InspectorsAndMonitors'>Inspectors and monitors
</a><br/>
<a href='/wiki/Displays'>Displays
</a><br/>
<a href='/wiki/BatchSpecific'>Batch Specific UI
</a><br/>
<a href='/wiki/ErrorsView'>Errors View
</a><br/>
    </div>
<a href='/wiki/Preferences'>Preferences
</a><br/>
    </div>
<a href='/wiki/GamlReferences'>Gaml Reference
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/BuiltInSpecies'>Built-in Species
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/AgentBuiltIn'>The 'agent' built-in species (Under Construction)
</a><br/>
<a href='/wiki/ModelBuiltIn'>The 'model' built-in species (Under Construction)
</a><br/>
<a href='/wiki/ExperimentBuiltIn'>The 'experiment' built-in species (Under Construction)
</a><br/>
    </div>
<a href='/wiki/BuiltInSkills'>Built-in Skills
</a><br/>
<a href='/wiki/BuiltInArchitectures'>Built-in Architectures
</a><br/>
<a href='/wiki/Statements'>Statements
</a><br/>
<a href='/wiki/DataTypes'>Types
</a><br/>
<a href='/wiki/FileTypes'>File Types
</a><br/>
<a href='/wiki/Expressions'>Expressions
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/Literals'>Literals
</a><br/>
<a href='/wiki/UnitsAndConstants'>Units and constants
</a><br/>
<a href='/wiki/PseudoVariables'>Pseudo-variables
</a><br/>
<a href='/wiki/VariablesAndAttributes'>Variables and Attributes
</a><br/>
<a href='/wiki/Operators'>Operators 
</a><br/>
    </div>
    </div>
    </div>
Community
</div></div></nav></div>
    <div class="w3-threequarter">
        <h1 id="comodel-with-mixed-behaviors">comodel with mixed behaviors</h1>

<p><em>Author : HUYNH Quang Nghi</em></p>

<p>This is a simple comodel serve to demonstrate the mixing behaviors of preyPredator with the Ants. Ants are the prey, fleeing from Predators, when they are not chasing, they try to do job of the ants.</p>

<p>Imported models :</p>

<div class="highlighter-rouge"><pre class="highlight"><code>model ants

global {
	//Evaporation value per cycle
	float evaporation_per_cycle &lt;- 5.0 min: 0.0 max: 240.0 parameter: 'Evaporation of the signal (unit/cycle):' category: 'Signals';
	//Diffusion rate of the pheromon among the grid
	float diffusion_rate &lt;- 1.0 min: 0.0 max: 1.0 parameter: 'Rate of diffusion of the signal (%/cycle):' category: 'Signals';
	//Size of the grid
	int gridsize &lt;- 100 min: 30 parameter: 'Width and Height of the grid:' category: 'Environment and Population';
	//Number of ants
	int ants_number &lt;- 200 min: 1 parameter: 'Number of ants:' category: 'Environment and Population';
	//Frequency of update of the grid
	int grid_frequency &lt;- 1 min: 1 max: 100 parameter: 'Grid updates itself every:' category: 'Environment and Population';
	//Number of food places among the grid
	int number_of_food_places &lt;- 5 min: 1 parameter: 'Number of food depots:' category: 'Environment and Population';
	float grid_transparency &lt;- 1.0;
	file ant_shape_empty const: true &lt;- file('../icons/ant.png');
	image_file ant_shape_full const: true &lt;- file('../icons/full_ant.png');
	//The center of the grid that will be considered as the nest location
	point center const: true &lt;- { round(gridsize / 2), round(gridsize / 2) };
	int food_gathered &lt;- 1;
	int food_placed &lt;- 1;
	rgb background const: true &lt;- rgb(#99CC66);
	rgb food_color const: true &lt;- rgb(#312200);
	rgb nest_color const: true &lt;- rgb(#000000); 

	geometry shape &lt;- square(gridsize);
	init {
		//Creation of the food places placed randomly with a certain distance between each
		loop times: number_of_food_places {
			point loc &lt;- { rnd(gridsize - 10) + 5, rnd(gridsize - 10) + 5 };
			list&lt;ant_grid&gt; food_places &lt;- (ant_grid where ((each distance_to loc) &lt; 5));
			ask food_places {
				if food = 0 {
					food &lt;- 5;
					food_placed &lt;- food_placed + 5;
					color &lt;- food_color;  
				}                                           
			}
		}
		//Creation of the ants that will be placed in the nest
		create ant number: ants_number with: (location: center);
	}
	//Reflex to diffuse the pheromon among the grid
	reflex diffuse {
      diffuse var:road on:ant_grid proportion: diffusion_rate radius:3 propagation: gradient method:convolution;
   }
  
}

//Grid used to discretize the space to place food
grid ant_grid width: gridsize height: gridsize neighbors: 8 frequency: grid_frequency use_regular_agents: false use_individual_shapes: false{
	bool is_nest const: true &lt;- (topology(ant_grid) distance_between [self, center]) &lt; 4;
	float road &lt;- 0.0 max: 240.0 update: (road &lt;= evaporation_per_cycle) ? 0.0 : road - evaporation_per_cycle;
	rgb color &lt;- is_nest ? nest_color : ((food &gt; 0) ? food_color : ((road &lt; 0.001) ? background : rgb(#009900) + int(road * 5))) update: is_nest ? nest_color : ((food &gt; 0) ?
	food_color : ((road &lt; 0.001) ? background : rgb(#009900) + int(road * 5)));
	int food &lt;- 0;
}
//Species ant that will move and follow a final state machine
species ant skills: [moving] control: fsm {
	float speed &lt;- 1.0;
	bool has_food &lt;- false;
	
	//Reflex to place a pheromon stock in the cell
	reflex diffuse_road when:has_food=true{
      ant_grid(location).road &lt;- ant_grid(location).road + 100.0;
   }
	//Action to pick food
	action pick (int amount) {
		has_food &lt;- true;
		ant_grid place &lt;- ant_grid(location);
		place.food &lt;- place.food - amount;
	}
	//Action to drop food
	action drop {
		food_gathered &lt;- food_gathered + 1;
		has_food &lt;- false;
		heading &lt;- heading - 180;
	}
	//Action to find the best place in the neighborhood cells
	point choose_best_place {
		container list_places &lt;- ant_grid(location).neighbors;
		if (list_places count (each.food &gt; 0)) &gt; 0 {
			return point(list_places first_with (each.food &gt; 0));
		} else {
			list_places &lt;- (list_places where ((each.road &gt; 0) and ((each distance_to center) &gt; (self distance_to center)))) sort_by (each.road);
			return point(last(list_places));
		}

	}
	//Reflex to drop food once the ant is in the nest
	reflex drop when: has_food and (ant_grid(location)).is_nest {
		do drop();
	}
	//Reflex to pick food when there is one at the same location
	reflex pick when: !has_food and (ant_grid(location)).food &gt; 0 {
		do pick(1);
	}
	//Initial state to make the ant wander 
	state wandering initial: true {
		do wander(amplitude: 90);
		float pr &lt;- (ant_grid(location)).road;
		transition to: carryingFood when: has_food;
		transition to: followingRoad when: (pr &gt; 0.05) and (pr &lt; 4);
	}
	//State to carry food once it has been found
	state carryingFood {
		do goto(target: center);
		transition to: wandering when: !has_food;
	}
	//State to follow a pheromon road if once has been found
	state followingRoad {
		point next_place &lt;- choose_best_place();
		float pr &lt;- (ant_grid(location)).road;
		location &lt;- next_place;
		transition to: carryingFood when: has_food;
		transition to: wandering when: (pr &lt; 0.05) or (next_place = nil);
	}

	aspect info {
		draw circle(1) empty: !has_food color: #red;
		if (destination != nil) {
			draw line([location + {0,0,0.5}, destination + {0,0,0.5}]) + 0.1 color: #white border: false;
		}

		draw circle(4) empty: true color: #white;
		draw string(self as int) color: #white font: font("Helvetica", 12 * #zoom, #bold) at: my location - {1, 1, -0.5};
		draw state color: #yellow  font: font("Helvetica", 10 * #zoom, #plain) at: my location + { 1, 1, 0.5 } perspective: false;
	}

	aspect icon {
		draw ant_shape_empty size: {7,5} rotate: my heading + 1;
	}

	aspect default {
		draw square(1) empty: !has_food color: #blue rotate: my heading;
	}
}	
//Simple experiment to display the ants
experiment Displays type: gui {
	point quadrant_size &lt;- { 0.5, 0.5 };
	float inc &lt;- 0.001;
	float pos &lt;- 0.0;
	reflex moving_quadrant {
	//pos &lt;- pos + inc;
		if (pos &gt; 0.5 or pos &lt;= 0) {
			inc &lt;- -inc;
		}
		
	}

	output {
		display Ants background: #white type: opengl {
			image '../images/soil.jpg' position: { pos, pos } size: quadrant_size;
			agents "agents" transparency: 0.5 position: { pos, pos } size: quadrant_size value: (ant_grid as list) where ((each.food &gt; 0) or (each.road &gt; 0) or (each.is_nest));
			species ant position: { pos, pos } size: quadrant_size aspect: icon;
			grid ant_grid lines: #darkgray position: { 0.5, 0 } size: quadrant_size;
			species ant position: { 0.5, 0 } size: quadrant_size aspect: info;
		}
	}
}
//Complete experiment that will inspect all ants in a table
experiment Complete type: gui {
	parameter 'Number:' var: ants_number init: 100 unit: 'ants' category: 'Environment and Population';
	parameter 'Grid dimension:' var: gridsize init: 100 unit: '(number of rows and columns)' category: 'Environment and Population';
	parameter 'Number of food depots:' var: number_of_food_places init: 5 min: 1 category: 'Environment and Population';

	// Experimentator

	init {
		write "Experimentator agent running " + self;
	   ants_number &lt;- 200;
	}


	output {
		display Ants2D type: java2D {
			image '../images/soil.jpg' position: { 0.05, 0.05 } size: { 0.9, 0.9 };
			agents "agents" transparency: 0.7 position: { 0.05, 0.05 } size: { 0.9, 0.9 } value: (ant_grid as list) where ((each.food &gt; 0) or (each.road &gt; 0) or (each.is_nest)) ;
			species ant position: { 0.05, 0.05 } size: { 0.9, 0.9 } aspect: icon;
			overlay "Texts" transparency: 0.3 background: rgb (99, 85, 66,255)  position: {10°px, 10°px} size: {250°px, 150°px} border: rgb (99, 85, 66,255) rounded: true{
				draw ant_shape_full at: {60°px, 70°px} size: {140°px, 100°px} rotate: -60;
				draw ('Food foraged: ' + (((food_placed = 0 ? 0 : food_gathered / food_placed) * 100) with_precision 2) + '%') at: {40°px,70°px} font:font("Arial", 18, #bold) color: #white;
				draw ('Carrying ants: ' + (((100 * ant count (each.has_food or each.state = "followingRoad")) / length(ant)) with_precision 2) + '%') at: {40°px, 100°px} font:font("Arial", 18 , #bold) color: #white;
			}
					
		}
		inspect "All ants" type: table value: ant attributes: ['name', 'location', 'heading','state'];
	}
}
//Batch experiment to find the best way to maximize the food gathered using exhaustive method
experiment Batch type: batch repeat: 4 keep_seed: true until: (food_gathered = food_placed) or (time &gt; 1000) {
	parameter 'Size of the grid:' var: gridsize init: 75 unit: 'width and height';
	parameter 'Number:' var: ants_number among:[10,20,50] unit: 'ants';
	parameter  'Evaporation:' var: evaporation_per_cycle among: [0.1, 0.5, 2.0, 10.0] unit: 'units every cycle';
	parameter  'Diffusion:' var: diffusion_rate min: 0.1 max: 1.0 unit: 'rate every cycle (1.0 means 100%)' step: 0.2;
	method exhaustive maximize: food_gathered;

	
	permanent {
		display Comparison background: #white {
			chart "Food Gathered" type: series {
					data "Min" value:  min(ants_model collect each.food_gathered ) style: spline color: #darkgreen ;
					data "Max" value:  max(ants_model collect each.food_gathered ) style: spline color: #red ;
			}
		}
	}
}

//Batch experiment to find the best way to maximize the food gathered using genetic method
experiment Genetic type: batch repeat: 2 keep_seed: true until: (food_gathered = food_placed) or (time &gt; 1000) {
	parameter 'Size of the grid:' var: gridsize init: 75 unit: '(width and height)';
	parameter 'Number:' var: ants_number among:[10,20,50] unit: 'ants';
	parameter  'Evaporation:' var: evaporation_per_cycle among: [0.1, 0.5, 2.0, 10.0] unit: 'units every cycle';
	parameter 'Diffusion:' var: diffusion_rate min: 0.1 max: 1.0 unit: 'rate every cycle (1.0 means 100%)' step: 0.2;
	method genetic maximize: food_gathered pop_dim: 5 crossover_prob: 0.7 mutation_prob: 0.1 nb_prelim_gen: 1 max_gen: 20;
	
		permanent {
		display Comparison background: #white {
			chart "Food Gathered" type: series {
					data "Min" value:  min(ants_model collect each.food_gathered ) style: spline color: #darkgreen ;
					data "Max" value:  max(ants_model collect each.food_gathered ) style: spline color: #red ;
			}
		}
	}
}

</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>model Ants_coupling

import "../../../Toy Models/Ants (Foraging and Sorting)/models/Ant Foraging (Complex).gaml" 



experiment Ants_coupling_exp type:gui  parent:Complete{
	
	list&lt;ant&gt; getAnts{
		return list(ant);
	}
	
	list&lt;ant_grid&gt; getAnt_grid{
		return list(ant_grid);
	}
	
	output{	
	}
}
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>model PreyPredator
 global
{
	geometry shape &lt;- square(100);
	float perceipt_radius &lt;- 20.0;
	int preyinit &lt;- 500;
	int predatorinit &lt;- 3;
	list&lt;agent&gt; lstPredator &lt;- list&lt;agent&gt;(predator);
	list&lt;agent&gt; lstPrey &lt;- list&lt;agent&gt;(prey);
	init
	{
		create prey number: preyinit;
		create predator number: predatorinit;
		lstPredator &lt;- list&lt;agent&gt;(predator);
		lstPrey &lt;- list&lt;agent&gt;(prey);
	}

}

species generic_species skills: [moving]
{
	float speed &lt;- 1.0;
	point goal &lt;- nil;
	bool is_chased &lt;- false;
	reflex live_with_my_goal
	{
		if (goal != nil)
		{
			do wander speed: speed;
			do goto target: goal speed: speed;
		} else
		{
			do wander speed: speed;
		}

	}

}

species prey parent: generic_species
{
	geometry shape &lt;- circle(0.5);
	float speed &lt;- 0.2;
	rgb color &lt;- # green;
	reflex fleeing
	{
		if (length((lstPredator where (each != nil and !dead(each) and each distance_to self &lt; perceipt_radius))) &gt; 0)
		{
			speed &lt;- 1.0;
			is_chased &lt;- true;
			color &lt;- # lime;
			if (goal = nil)
			{
				agent a &lt;- any(((lstPrey where (each != nil and !dead(each) and !generic_species(each).is_chased))));
				if (a != nil and !dead(a))
				{
					if (flip(0.5))
					{
						goal &lt;- a.location;
					} else
					{
						goal &lt;- any_location_in(world.shape);
					}

				} else
				{
					goal &lt;- any_location_in(world.shape);
				}

			}

		}

		if (goal != nil and self.location distance_to goal &lt; 0.5)
		{
			goal &lt;- nil;
		}

		if (length((lstPredator where (each != nil and !dead(each))) where (each distance_to self &lt;= perceipt_radius)) = 0)
		{
			is_chased &lt;- false;
			color &lt;- # green;
			speed &lt;- 0.2;
		}

	}

	aspect default
	{
		draw shape color: color;
	}

}

species predator parent: generic_species
{
	geometry shape &lt;- triangle(2);
	rgb color &lt;- # red;
	reflex hunting
	{
		if (goal = nil)
		{
			list tmp &lt;- (lstPrey where (!dead(each) and each.shape distance_to self.shape &lt; perceipt_radius));
			if (length(tmp) &gt; 0)
			{
				agent a &lt;- first(tmp sort (each.shape distance_to self.shape));
				if (a = nil)
				{
					a &lt;- any((lstPrey where (!dead(each))));
				}

				if (a != nil)
				{
					speed &lt;- 2.0;
					goal &lt;- a.location;
				}

			}

		} else if ((self.location distance_to goal &lt; 0.5))
		{
			ask lstPrey where (!dead(each) and each.location distance_to goal &lt; 0.5)
			{
				do die;
			}

			goal &lt;- nil;
			speed &lt;- 1.0;
		}

	}

	aspect default
	{
		draw circle(perceipt_radius) color: # pink empty: true;
		draw shape color: color rotate: 90 + my heading;
	}

}

experiment prey_predator_exp type: gui
{
	output
	{
		display main_display

		{
			species prey;
			species predator;
		}

	}

}
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>model PreyPredator_coupling
import "PreyPredator.gaml"

global
{	
}

experiment PreyPredator_coupling_exp parent:prey_predator_exp type: gui
{
geometry shape&lt;- square(100);
	list&lt;prey&gt; getPrey{
		return list(prey);
	}
		list&lt;predator&gt; getPredator{
		return list(predator);
	}
	
	//if we redefine the output, i.e, a blank output, the displays in parent experiement dont show.
	output
	{
	}

}


</code></pre>
</div>

<p>Code of the model :</p>

<div class="highlighter-rouge"><pre class="highlight"><code>model comodel_mix_behaviors

import "PreyPredator_coupling.gaml" as myPreyPredator
import "Ants_coupling.gaml" as myAnt


global
{
	//set the shape of environment: square 100 
	geometry shape &lt;- square(100);
	// the variable that refer to the ants population in micro-model 
	list&lt;agent&gt; theAnts;
	// the variable that refer to the prey population in micro-model
	list&lt;prey&gt; thePreys;
	
	init
	{
		//create the Ants micro-model with the size of grid is 100 and the population have 500 ants.
		create myAnt.Ants_coupling_exp with: [gridsize::100,ants_number::500];
		//create the PreyPredator micro-model with the parameters and the number of the prey is equal with the size of ants population
		create myPreyPredator.PreyPredator_coupling_exp with: [shape::square(100), preyinit::myAnt.Ants_coupling_exp[0].simulation.ants_number, predatorinit::3]  
		{
			// set the size of micro-model PreyPredator equal with the size of the grid of myAnt
			shape &lt;- square(100);
		}

		// save the original population of the Ants and the Preys
		theAnts &lt;- myAnt.Ants_coupling_exp accumulate each.getAnts();
		thePreys &lt;- list&lt;prey&gt;(myPreyPredator.PreyPredator_coupling_exp accumulate each.getPrey());


	}

	reflex simulate_micro_models
	{
		// ask myAnt do a step
		ask (myAnt.Ants_coupling_exp collect each.simulation)
		{
			do _step_;
		}
		// ask myPreyPredator do a step, too
		ask (myPreyPredator.PreyPredator_coupling_exp collect each.simulation)
		{
			do _step_;
		}

		//check if a Prey is chased, set the position of that agent to the location of prey 
		//if not, set ant's location to agent location.
		// if the agent (prey) died, then tell the ant do die
		loop i from: 0 to: length(theAnts) - 1
		{
			if (!dead(thePreys at i) and !dead(theAnts at i))
			{
				if (!(thePreys at i).is_chased)
				{
					(thePreys at i).location &lt;- (theAnts at i).location;
				} else
				{
					(theAnts at i).location &lt;- (thePreys at i).location;
				}

			} else
			{
				ask (theAnts at i)
				{
					do die;
				}

			}

		}

	}

}

experiment comodel_mix_behaviors_exp type: gui
{
	output
	{
		display "comodel"
		{
			agents "ant_grid" value: myAnt.Ants_coupling_exp accumulate each.getAnt_grid() transparency: 0.7;
			agents "agentprey" value: (myPreyPredator.PreyPredator_coupling_exp accumulate each.getPrey());
			agents "agentpredator" value: (myPreyPredator.PreyPredator_coupling_exp accumulate each.getPredator());
		}

	}

}
</code></pre>
</div>

    </div>
    </div>
    </div>
    </body></html>
