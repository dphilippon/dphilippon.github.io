
    <!doctype html><html lang="en"><head><meta charset="utf-8"><title>Control Architectures</title></head>
    <body>
    <link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/w3.css">
<link rel="stylesheet" href="/css/font-awesome.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<script src="//connect.facebook.net/en_US/all.js"></script>
<script src="/js/linkify.min.js"></script>
<script src="/js/linkify-jquery.min.js"></script>

    <div class="w3-bar w3-white w3-hide-small">
      <a href="/" class="w3-bar-item w3-button"><img src="/images/icon_gama_50.png"></a>
      <a href="/wiki/Home" class="w3-bar-item w3-button w3-text-blue">Documentation</a>
      <a href="/wiki/Tutorials" class="w3-bar-item w3-button w3-text-blue">Tutorials</a>
      <a href="/download" class="w3-bar-item w3-button w3-text-blue">Download</a>
      <a href="/news" class="w3-bar-item w3-button w3-text-blue">News</a>
      <a href="/contribute" class="w3-bar-item w3-button w3-text-blue">Contribute</a>
    </div>

    <div class="w3-row-padding w3-padding-64 w3-container">
        <div>
             <div class="w3-quarter" style="width:260px">
		<nav class="w3-bar-block w3-collapse w3-large w3-theme-l5 w3-animate-left w3-small"  style="z-index:3;margin-left:10px" id="mySidebar">
                    <div class="w3-medium w3-text-blue" style="font-weight:bold"><div>
<a href='/wiki/Tutorials'>Tutorials
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/LearnGAMLStepByStep'>Learn GAML Step by Step
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/Introduction'>Introduction
</a><br/>
<a href='/wiki/StartWithGAML'>Start with GAML
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/ModelOrganization'>Organization of a model
</a><br/>
<a href='/wiki/BasicProgrammingConceptsInGAML'>Basic programming concepts in GAML
</a><br/>
    </div>
<a href='/wiki/ManipulateBasicSpecies'>Manipulate basic species
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/GlobalSpecies'>The global species
</a><br/>
<a href='/wiki/RegularSpecies'>Regular species
</a><br/>
<a href='/wiki/DefiningActionsAndBehaviors'>Defining actions and behaviors
</a><br/>
<a href='/wiki/InteractionBetweenAgents'>Interaction between agents
</a><br/>
<a href='/wiki/AttachingSkills'>Attaching Skills
</a><br/>
<a href='/wiki/Inheritance'>Inheritance
</a><br/>
    </div>
<a href='/wiki/DefiningAdvancedSpecies'>Defining advanced species
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/GridSpecies'>Grid Species
</a><br/>
<a href='/wiki/GraphSpecies'>Graph Species
</a><br/>
<a href='/wiki/MirrorSpecies'>Mirror species
</a><br/>
<a href='/wiki/MultiLevelArchitecture'>Multi-level architecture
</a><br/>
    </div>
<a href='/wiki/DefiningGUIExperiment'>Defining GUI Experiment
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/DefiningParameters'>Defining Parameters
</a><br/>
<a href='/wiki/DefiningDisplaysGeneralities'>Defining displays (Generalities)
</a><br/>
<a href='/wiki/DefiningCharts'>Defining Charts
</a><br/>
<a href='/wiki/Defining3DDisplays'>Defining 3D Displays
</a><br/>
<a href='/wiki/DefiningMonitorsAndInspectors'>Defining monitors and inspectors
</a><br/>
<a href='/wiki/DefiningExportFiles'>Defining export files
</a><br/>
<a href='/wiki/DefiningUserInteraction'>Defining user interaction
</a><br/>
    </div>
<a href='/wiki/ExploringModels'>Exploring Models
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/RunSeveralSimulations'>Run Several Simulations
</a><br/>
<a href='/wiki/BatchExperiments'>Defining Batch Experiments
</a><br/>
<a href='/wiki/ExplorationMethods'>Exploration Methods
</a><br/>
    </div>
<a href='/wiki/OptimizingModels'>Optimizing Models
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/RuntimeConcepts'>Runtime Concepts
</a><br/>
OptimizingModelsSelection
    </div>
<a href='/wiki/MultiParadigmModeling'>Multi-Paradigm Modeling
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/ControlArchitecture'>Control Architectures
</a><br/>
<a href='/wiki/Equations'>Using Equations
</a><br/>
    </div>
    </div>
<a href='/wiki/Recipes'>Recipes
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/ManipulateOSMDatas'>Manipulate OSM Datas
</a><br/>
<a href='/wiki/Diffusion'>Implementing diffusion
</a><br/>
<a href='/wiki/UsingDatabase'>Using Database Access
</a><br/>
<a href='/wiki/CallingR'>Calling R
</a><br/>
<a href='/wiki/UsingFIPAACL'>Using FIPA ACL
</a><br/>
<a href='/wiki/GamAnalyzer'>Using GAMAnalyzer
</a><br/>
<a href='/wiki/UsingBDI'>Using BDI
</a><br/>
<a href='/wiki/UsingDrivingSkill'>Advanced Driving Skill
</a><br/>
<a href='/wiki/ManipulateDates'>Manipulate Dates
</a><br/>
<a href='/wiki/ManipulateLight'>Implementing light
</a><br/>
<a href='/wiki/Comodel'>Using Comodel
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
—Headlessmodefordummies
    </div>
    </div>
    </div>
<a href='/wiki/Tutorials'>Tutorials
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/LuneraysFlu'>Luneray's flu
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/LuneraysFlu_step1'>1. Creation of a first basic disease spreading model
</a><br/>
<a href='/wiki/LuneraysFlu_step2'>2. Definition of monitors and chart outputs
</a><br/>
<a href='/wiki/LuneraysFlu_step3'>3. Importation of GIS data
</a><br/>
<a href='/wiki/LuneraysFlu_step4'>4. Use of a graph to constraint the movements of people]
</a><br/>
<a href='/wiki/LuneraysFlu_step5'>5. Definition of 3D displays
</a><br/>
    </div>
<a href='/wiki/IncrementalModel'>Incremental Model
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/IncrementalModel_step1'>1. Simple SI Model
</a><br/>
<a href='/wiki/IncrementalModel_step2'>2. Charts
</a><br/>
<a href='/wiki/IncrementalModel_step3'>3. Integration of GIS Data
</a><br/>
<a href='/wiki/IncrementalModel_step4'>4. Movement on Graph
</a><br/>
<a href='/wiki/IncrementalModel_step5'>5. Visualizing in 3D
</a><br/>
<a href='/wiki/IncrementalModel_step6'>6. Multi-Level
</a><br/>
<a href='/wiki/IncrementalModel_step7'>7. Differential Equations
</a><br/>
    </div>
<a href='/wiki/PredatorPrey'>Predator Prey
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/PredatorPrey_step1'>1. Basic Model
</a><br/>
<a href='/wiki/PredatorPrey_step2'>2. Vegetation Dynamic
</a><br/>
<a href='/wiki/PredatorPrey_step3'>3. Prey Agent Behavior
</a><br/>
<a href='/wiki/PredatorPrey_step4'>4. Inspectors and Monitors
</a><br/>
<a href='/wiki/PredatorPrey_step5'>5. Predator Agent
</a><br/>
<a href='/wiki/PredatorPrey_step6'>6. Breeding
</a><br/>
<a href='/wiki/PredatorPrey_step7'>7. Agent Aspect
</a><br/>
<a href='/wiki/PredatorPrey_step8'>8. Complex Behavior
</a><br/>
<a href='/wiki/PredatorPrey_step9'>9. Stopping condition
</a><br/>
<a href='/wiki/PredatorPrey_step10'>10. Charts
</a><br/>
<a href='/wiki/PredatorPrey_step11'>11. Writing Files
</a><br/>
<a href='/wiki/PredatorPrey_step12'>12. Image loading
</a><br/>
    </div>
<a href='/wiki/RoadTrafficModel'>Road Traffic
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/RoadTrafficModel_step1'>1. Loading of GIS Data
</a><br/>
<a href='/wiki/RoadTrafficModel_step2'>2. People Agents
</a><br/>
<a href='/wiki/RoadTrafficModel_step3'>3. Movement of People
</a><br/>
<a href='/wiki/RoadTrafficModel_step4'>4. Weight for Road Network
</a><br/>
<a href='/wiki/RoadTrafficModel_step5'>5. Dynamic weights
</a><br/>
<a href='/wiki/RoadTrafficModel_step6'>6. Charts
</a><br/>
<a href='/wiki/RoadTrafficModel_step7'>7. Automatic Road Repair
</a><br/>
    </div>
<a href='/wiki/ThreeD'>3D Tutorial
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/ThreeD_step1'>1. Basic Model
</a><br/>
<a href='/wiki/ThreeD_step2'>2. Moving Cells
</a><br/>
<a href='/wiki/ThreeD_step3'>3. Connections
</a><br/>
    </div>
    </div>
    </div>
<a href='/wiki/References'>References
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/PlatformDocumentation'>Platform
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/InstallationAndLaunching'>Installation and Launching
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/Installation'>Installation
</a><br/>
<a href='/wiki/Launching'>Launching GAMA
</a><br/>
<a href='/wiki/Headless'>Headless Mode
</a><br/>
<a href='/wiki/Updating'>Updating GAMA
</a><br/>
<a href='/wiki/InstallingPlugins'>Installing Plugins
</a><br/>
<a href='/wiki/Troubleshooting'>Troubleshooting
</a><br/>
    </div>
<a href='/wiki/WorkspaceProjectsAndModels'>Workspace, Projects and Models
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/NavigatingWorkspace'>Navigating in the Workspace
</a><br/>
<a href='/wiki/ChangingWorkspace'>Changing Workspace
</a><br/>
<a href='/wiki/ImportingModels'>Importing Models
</a><br/>
    </div>
<a href='/wiki/EditingModels'>Editing models
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/GamlEditorGeneralities'>The GAML Editor - Generalities
</a><br/>
<a href='/wiki/GamlEditorToolbar'>The GAML Editor Toolbar
</a><br/>
<a href='/wiki/ValidationOfModels'>Validation of Models
</a><br/>
    </div>
<a href='/wiki/RunningExperiments'>Running Experiments
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/LaunchingExperiments'>Launching Experiments from the User Interface
</a><br/>
<a href='/wiki/ExperimentsUserInterface'>Experiments User Interface
</a><br/>
<a href='/wiki/MenusAndCommands'>Menus and Commands
</a><br/>
<a href='/wiki/ParametersView'>Parameters View
</a><br/>
<a href='/wiki/InspectorsAndMonitors'>Inspectors and monitors
</a><br/>
<a href='/wiki/Displays'>Displays
</a><br/>
<a href='/wiki/BatchSpecific'>Batch Specific UI
</a><br/>
<a href='/wiki/ErrorsView'>Errors View
</a><br/>
    </div>
<a href='/wiki/Preferences'>Preferences
</a><br/>
    </div>
<a href='/wiki/GamlReferences'>Gaml Reference
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/BuiltInSpecies'>Built-in Species
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/AgentBuiltIn'>The 'agent' built-in species (Under Construction)
</a><br/>
<a href='/wiki/ModelBuiltIn'>The 'model' built-in species (Under Construction)
</a><br/>
<a href='/wiki/ExperimentBuiltIn'>The 'experiment' built-in species (Under Construction)
</a><br/>
    </div>
<a href='/wiki/BuiltInSkills'>Built-in Skills
</a><br/>
<a href='/wiki/BuiltInArchitectures'>Built-in Architectures
</a><br/>
<a href='/wiki/Statements'>Statements
</a><br/>
<a href='/wiki/DataTypes'>Types
</a><br/>
<a href='/wiki/FileTypes'>File Types
</a><br/>
<a href='/wiki/Expressions'>Expressions
</a><br/>
      <div id='sub' class=' w3-padding-small w3-bar-block w3-small'>
<a href='/wiki/Literals'>Literals
</a><br/>
<a href='/wiki/UnitsAndConstants'>Units and constants
</a><br/>
<a href='/wiki/PseudoVariables'>Pseudo-variables
</a><br/>
<a href='/wiki/VariablesAndAttributes'>Variables and Attributes
</a><br/>
<a href='/wiki/Operators'>Operators 
</a><br/>
    </div>
    </div>
    </div>
Community
</div></div></nav></div>
    <div class="w3-threequarter">
        <h1 id="control-architectures">Control Architectures</h1>

<p>GAMA allows to attach built-in control architecture to agents.</p>

<p>These control architectures will give the possibility to the modeler to use for a species a specific control architecture in addition to the <a href="DefiningActionsAndBehaviors#Behaviour">common behavior structure</a>. Note that only one control architecture can be used per species.</p>

<p>The attachment of a control architecture to a species is done through the facets <code class="highlighter-rouge">control</code>.</p>

<p>For example, the given code allows to attach the <code class="highlighter-rouge">fsm</code> control architecture to the dummy species.</p>
<div class="highlighter-rouge"><pre class="highlight"><code>species dummy control: fsm {
}
</code></pre>
</div>

<p>GAMA integrates several agent control architectures that can be used in addition to the common behavior structure:</p>

<ul>
  <li><a href="#finite-state-machine">fsm</a>: finite state machine based behavior model. During its life cycle, the agent can be in several states. At any given time step, it is in one single state. Such an agent needs to have one initial state (the state in which it will be at its initialization)</li>
  <li><a href="#task-based">weighted_tasks</a>: task-based control architecture. At any given time, only the task only the task with the maximal weight is executed.</li>
  <li><a href="#task-based">sorted_tasks</a>: task-based control architecture. At any given time, the tasks are all executed in the order specified by their weights (highest first).</li>
  <li><a href="#task-based">probabilistic_tasks</a>: task-based control architecture. This architecture uses the weights as a support for making a weighted probabilistic choice among the different tasks. If all tasks have the same weight, one is randomly chosen at each step.</li>
  <li><a href="DefiningUserInteraction#user-control-architecture">user_only</a>: allows users to take control over an agent during the course of the simulation. With this architecture, only the user control the agents (no reflexes).</li>
  <li><a href="user-control-architecture">user_first</a>: allows users to take control over an agent during the course of the simulation. With this architecture, the user actions are executed before the agent reflexes.</li>
  <li><a href="user-control-architecture">user_last</a>: allows users to take control over an agent during the course of the simulation. With this architecture, the user actions are executed after the agent reflexes.</li>
</ul>

<h2 id="index">Index</h2>

<ul>
  <li><a href="#finite-state-machine">Finite State Machine</a>
    <ul>
      <li><a href="#declaration">Declaration</a></li>
      <li><a href="#state">State</a></li>
    </ul>
  </li>
  <li><a href="#task-based">Task Based</a>
    <ul>
      <li><a href="#declaration">Declaration</a></li>
      <li><a href="#task">Task</a></li>
    </ul>
  </li>
  <li><a href="#user-control-architectures">User Control Architecture</a>
    <ul>
      <li><a href="#user_only-user_first-user_last">user_only, user_first, user_last</a></li>
      <li><a href="#user_panel">user_panel</a></li>
      <li><a href="#user_controlled">user_controlled</a></li>
    </ul>
  </li>
  <li><a href="#other-control-architectures">Other Control Architectures</a></li>
</ul>

<h2 id="finite-state-machine">Finite State Machine</h2>

<p><strong>FSM (Finite State Machine)</strong> is a finite state machine based behavior model. During its life cycle, the agent can be in several states. At any given time step, it is in one single state. Such an agent needs to have one initial state (the state in which it will be at its initialization).</p>

<p>At each time step, the agent will:</p>

<ul>
  <li>first (only if he just entered in its current state) execute statement embedded in the <code class="highlighter-rouge">enter</code> statement,</li>
  <li>then all the statements in the state statement</li>
  <li>it will evaluate the condition of each embedded transition statements. If one condition is fulfilled, the agent execute the embedded statements</li>
</ul>

<p>Note that an agent executes only one state at each step.</p>

<h3 id="declaration">Declaration</h3>

<p>Using the FSM architecture for a species require to use the <strong>control</strong> facet:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>species dummy control: fsm {
   ...
}
</code></pre>
</div>

<h3 id="state">State</h3>

<h4 id="attributes">Attributes</h4>
<ul>
  <li>initial: a boolean expression, indicates the initial state of agent.</li>
  <li>final: a boolean expression, indicates the final state of agent.</li>
</ul>

<h4 id="sub-statements">Sub Statements</h4>
<ul>
  <li>enter: a sequence of statements to execute upon entering the state.</li>
  <li>exit: a sequence of statements to execute right before exiting the state. Note that the <code class="highlighter-rouge">exit</code> statement will be executed even if the fired transition points to the same state (the FSM architecture in GAMA does not implement ‘internal transitions’ like the ones found in UML state charts: all transitions, even “self-transitions”, follow the same rules).</li>
  <li>transition: allows to define a condition that, when evaluated to true, will designate the next state of the life cycle. Note that the evaluation of transitions is short-circuited: the first one that evaluates to true, in the order in which they have been defined, will be followed. I.e., if two transitions evaluate to true during the same time step, only the first one will be triggered.</li>
</ul>

<p>Things worth to be mentioned regarding these sub-statements:</p>

<ul>
  <li>Obviously, only one definition of exit and enter is accepted in a given state</li>
  <li>Transition statements written in the middle of the state statements will only be evaluated at the end, so, even if it evaluates to true, the remaining of the statements found after the definition of the transition will be nevertheless executed. So, despite the appearance, a transition written somewhere in the sequence will “not stop” the state at that point (but only at the end).</li>
</ul>

<h4 id="definition">Definition</h4>
<p>A state can contain several statements that will be executed, at each time step, by the agent. There are three exceptions to this rule:</p>

<ol>
  <li>statements enclosed in <code class="highlighter-rouge">enter</code> will only be executed when the state is entered (after a transition, or because it is the initial state).</li>
  <li>Those enclosed in <code class="highlighter-rouge">exit</code> will be executed when leaving the state as a result of a successful transition (and before the statements enclosed in the transition).</li>
  <li>Those enclosed in a transition will be executed when performing this transition (but after the <code class="highlighter-rouge">exit</code> sequence has been executed).</li>
</ol>

<p>For example, consider the following example:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>species dummy control: fsm {       
	state state1 initial: true { 
		write string(cycle) + ":" + name + "-&gt;" + "state1";
		transition to: state2 when: flip(0.5) {
			write string(cycle) + ":" + name + "-&gt;" + "transition to state1";
		}
		transition to: state3 when: flip(0.2) ; 
	}

	state state2 {
		write string(cycle) + ":" + name + "-&gt;" + "state2";
		transition to: state1 when: flip(0.5) { 
			write string(cycle) + ":" + name + "-&gt;" + "transition to state1";
		}
		exit {
			write string(cycle) + ":" + name + "-&gt;" + "leave state2";
		}
	}
	
	state state3 {
		write string(cycle) + ":" + name + "-&gt;" + "state3";
		transition to: state1 when: flip(0.5)  {
			write string(cycle) + ":" + name + "-&gt;" + "transition to state1";
		}
		transition to: state2 when: flip(0.2)  ;
	}   
}
</code></pre>
</div>

<p>the dummy agents start at <em>state1</em>. At each simulation step they have a probability of 0.5 to change their state to <em>state2</em>. If they do not change their state to <em>state2</em>, they have a probability of 0.2 to change their state to <em>state3</em>. In <em>state2</em>, at each simulation step, they have a probability of 0.5 to change their state to <em>state1</em>. At last, in <em>step3</em>, at each simulation step they have a probability of 0.5 to change their state to <em>state1</em>. If they do not change their state to <em>state1</em>, they have a probability of 0.2 to change their state to <em>state2</em>.</p>

<p>Here a possible result that can be obtained with one dummy agent:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>0:dummy0-&gt;state1
0:dummy0-&gt;transition to state1
1:dummy0-&gt;state2
2:dummy0-&gt;state2
2:dummy0-&gt;leave state2
2:dummy0-&gt;transition to state1
3:dummy0-&gt;state1
3:dummy0-&gt;transition to state1
4:dummy0-&gt;state2
5:dummy0-&gt;state2
5:dummy0-&gt;leave state2
5:dummy0-&gt;transition to state1
6:dummy0-&gt;state1
7:dummy0-&gt;state3
8:dummy0-&gt;state2
</code></pre>
</div>

<h2 id="task-based">Task Based</h2>

<p>GAMA integrated several <strong>task-based</strong> control architectures. Species can define any number of tasks within their body. At any given time, only one or several tasks are executed according to the architecture chosen:</p>

<ul>
  <li><strong>weighted_tasks</strong> : in this architecture, only the task with the maximal weight is executed.</li>
  <li><strong>sorted_tasks</strong> : in this architecture, the tasks are all executed in the order specified by their weights (biggest first)</li>
  <li><strong>probabilistic_tasks</strong>: this architecture uses the weights as a support for making a weighted probabilistic choice among the different tasks. If all tasks have the same weight, one is randomly chosen each step.</li>
</ul>

<h3 id="declaration-1">Declaration</h3>

<p>Using the Task architectures for a species require to use the <strong>control</strong> facet:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>species dummy control: weighted_tasks {
   ...
}
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>species dummy control: sorted_tasks {
   ...
}
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>species dummy control: probabilistic_tasks {
   ...
}
</code></pre>
</div>

<h3 id="task">Task</h3>

<h4 id="sub-elements">Sub elements</h4>
<p>Besides a sequence of statements like reflex, a task contains the following sub elements:</p>
<ul>
  <li>weight: Mandatory. The priority level of the task.</li>
</ul>

<h4 id="definition-1">Definition</h4>
<p>As reflex, a task is a sequence of statements that can be executed, at each time step, by the agent. If an agent owns several tasks, the scheduler chooses a task to execute based on its current priority weight value.</p>

<p>For example, consider the following example:</p>
<div class="highlighter-rouge"><pre class="highlight"><code>species dummy control: weighted_tasks {   
	task task1 weight: cycle mod 3 { 
		write string(cycle) + ":" + name + "-&gt;" + "task1";
	}
	task task2 weight: 2 { 
		write string(cycle) + ":" + name + "-&gt;" + "task2";
	}
}
</code></pre>
</div>

<p>As the <strong>weighted_tasks</strong> control architecture was chosen, at each simulation step, the dummy agents execute only the task with the highest behavior. Thus,  when <em>cycle modulo 3</em> is higher to 2, task1 is executed; when <em>cycle modulo 3</em> is lower than 2, task2 is executed. In case when <em>cycle modulo 3</em> is equal 2 (at cycle 2, 5, …), the only the first task defined (here task1) is executed.</p>

<p>Here the result obtained with one dummy agent:</p>
<div class="highlighter-rouge"><pre class="highlight"><code>0:dummy0-&gt;task2
1:dummy0-&gt;task2
2:dummy0-&gt;task1
3:dummy0-&gt;task2
4:dummy0-&gt;task2
5:dummy0-&gt;task1
6:dummy0-&gt;task2
</code></pre>
</div>

<h2 id="user-control-architecture">User Control Architecture</h2>

<h3 id="user_only-user_first-user_last">user_only, user_first, user_last</h3>

<p>A specific type of control architecture has been introduced to allow users to take control over an agent during the course of the simulation. It can be invoked using three different keywords: <code class="highlighter-rouge">user_only</code>, <code class="highlighter-rouge">user_first</code>, <code class="highlighter-rouge">user_last</code>.</p>
<div class="highlighter-rouge"><pre class="highlight"><code>species user control: user_only {
   ...
}
</code></pre>
</div>

<p>If the control chosen is <code class="highlighter-rouge">user_first</code>, it means that the user controlled panel is opened first, and then the agent has a chance to run its “own” behaviors (reflexes, essentially, or “init” in the case of a “user_init” panel).
If the control chosen is <code class="highlighter-rouge">user_last</code>, it is the contrary.</p>

<h3 id="user_panel">user_panel</h3>

<p>This control architecture is a specialization of the Finite State Machine Architecture where the “behaviors” of agents can be defined by using new constructs called <code class="highlighter-rouge">user_panel</code> (and one <code class="highlighter-rouge">user_init</code>), mixed with “states” or “reflexes”. This <code class="highlighter-rouge">user_panel</code> translates, in the interface, in a semi-modal view that awaits the user to choose action buttons, change attributes of the controlled agent, etc. Each <code class="highlighter-rouge">user_panel</code>, like a <code class="highlighter-rouge">state</code> in FSM, can have a <code class="highlighter-rouge">enter</code> and <code class="highlighter-rouge">exit</code> sections, but it is only defined in terms of a set of <code class="highlighter-rouge">user_command</code>s which describe the different action buttons present in the panel.</p>

<p>user_commands can also accept inputs, in order to create more interesting commands for the user. This uses the <code class="highlighter-rouge">user_input</code> statement (and not operator), which is basically the same as a temporary variable declaration whose value is asked to the user. Example:</p>

<p>As <code class="highlighter-rouge">user_panel</code> is a specialization of <code class="highlighter-rouge">state</code>, the modeler has the possibility to describe several panels and choose the one to open depending on some condition, using the same syntax than for finite state machines :</p>
<ul>
  <li>either adding <code class="highlighter-rouge">transitions</code> to the user_panels,</li>
  <li>or setting the <code class="highlighter-rouge">state</code> attribute to a new value, from inside or from another agent.</li>
</ul>

<p>This ensures a great flexibility for the design of the user interface proposed to the user, as it can be adapted to the different stages of the simulation, etc…</p>

<p>Follows a simple example, where, every 10 steps, and depending on the value of an attribute called “advanced”, either the basic or the advanced panel is proposed.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>species user control:user_only {
   user_panel default initial: true {
      transition to: "Basic Control" when: every (10) and !advanced_user_control;
      transition to: "Advanced Control" when: every(10) and advanced_user_control;
   }
   
   user_panel "Basic Control" {
      user_command "Kill one cell" {
         ask (one_of(cell)){
            do die;
         }
      }
      user_command "Create one cell" {
        create cell ;
      } 
      transition to: default when: true;
   }
   user_panel "Advanced Control" {
      user_command "Kill cells" {
        user_input "Number" returns: number type: int &lt;- 10;
        ask (number among cell){
           do die;
        }
      }
      user_command "Create cells" {
        user_input "Number" returns: number type: int &lt;- 10;
        create cell number: number ;
      } 
      transition to: default when: true;
   }
}
</code></pre>
</div>

<p>The panel marked with the “<em>initial: true</em>” facet will be the one run first when the agent is supposed to run. If none is marked, the first panel (in their definition order) is chosen.</p>

<p>A special panel called user_init will be invoked only once when initializing the agent if it is defined.
If no panel is described or if all panels are empty (i.e. no user_commands), the control view is never invoked. If the control is said to be “user_only”, the agent will then not run any of its behaviors.</p>

<h3 id="user_controlled">user_controlled</h3>

<p>Finally, each agent provided with this architecture inherits a boolean attribute called <code class="highlighter-rouge">user_controlled</code>. If this attribute becomes false, no panels will be displayed and the agent will run “normally” unless its species is defined with a <code class="highlighter-rouge">user_only</code> control.
<a href="# (keyword|architecture_user_only)">//</a>: # (endConcept|user_control_architecture)</p>

<h2 id="other-control-architectures">Other Control Architectures</h2>

<p>Some other control architectures are available in additional plugins. For instance, <a href="UsingBDI">BDI (Belief, desire, intention) architecture</a> is available. Feel free to read about it if you want to learn more.</p>

<p>You need some other control architectures for your model ? Feel free to make your suggestion to the team of developer through the <a href="https://groups.google.com/forum/#!forum/gama-platform">mailing list</a>. Remember also that GAMA is an open-source platform, you can design your own control architecture easily. Go to the section Community/contribute if you want to jump into coding !</p>

    </div>
    </div>
    </div>
    </body></html>
