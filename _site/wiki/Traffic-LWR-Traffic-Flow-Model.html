
    <!doctype html><html lang="en"><head><meta charset="utf-8"><title>Trafic Group (R2D2) MAPS7 - LWR Model</title></head>
    <body>
    <link rel="stylesheet" href="/style.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<script src="//connect.facebook.net/en_US/all.js"></script>
<script src="/linkify.min.js"></script>
<script src="/linkify-jquery.min.js"></script>
<script>
  $(document).ready(function(){
	  		$.getJSON('https://graph.facebook.com/238065426321929/feed?access_token=229040647557399|MQKFlFYX7YW25XGj4GUYZ7B1lcY', function(data) {
		var ahtml="";
		for(var i = 0; i < 5; i++) {
			ahtml=ahtml+"<li>"+data["data"][i]["message"]+"</li>";
		}
		ahtml=ahtml+"";
		$("#fbquotes").html(ahtml);
		$("#fbquotes").linkify();
	});
	 
		$.getJSON('https://api.github.com/repos/gama-platform/gama/commits', function(data) {
			var ahtml="";
			for(var i = 0; i < 5; i++) {
				ahtml=ahtml+"<li>"+data[i]["commit"]["message"]+" by "+data[i]["commit"]["author"]["name"]+" <a href='"+data[i]["commit"]["html_url"]+"'> See more</a></li>";
			}
			ahtml=ahtml+"";
			$("#commitquotes").html(ahtml);
			$("#commitquotes").linkify();
		});
				
				
		$.getJSON('https://api.github.com/repos/gama-platform/gama/issues', function(data) {
			var ahtml="";
			for(var i = 0; i < 5; i++) {
				ahtml=ahtml+"<li>"+data[i]["title"]+" by "+data[i]["user"]["login"]+" <a href='"+data[i]["html_url"]+"'> See more</a></li>";
			}
			ahtml=ahtml+"";
			$("#issuequotes").html(ahtml);
			$("#issuequotes").linkify();
		});
		
		$.getJSON('https://api.rss2json.com/v1/api.json?rss_url=https%3A%2F%2Fgroups.google.com%2Fforum%2Ffeed%2Fgama-platform%2Ftopics%2Frss.xml%3Fnum%3D15', function(data) {
			var ahtml="";
			for(var i = 0; i < 5; i++) {
				ahtml=ahtml+"<li>"+data["items"][i]["title"]+" by "+data["items"][i]["author"]+" <a href='"+data["items"][i]["link"]+"'> See more</a></li>";
			}
			ahtml=ahtml+"";
			$("#googleusersquotes").html(ahtml);
			$("#googleusersquotes").linkify();
			
		});
 });
  
</script>

      <div id="left">

		<ul class="mcd-menu"><li><a href="/">Home</a></li><li><a href="/">Discussions</a></li>
<li><a href='/wiki/Tutorials'>Tutorials
</a></li>
<ul class='sub'>
<li><a href='/wiki/LearnGAMLStepByStep'>Learn GAML Step by Step
</a></li>
<ul class='sub'>
<li><a href='/wiki/Introduction'>Introduction
</a></li>
<li><a href='/wiki/StartWithGAML'>Start with GAML
</a></li>
<ul class='sub'>
<li><a href='/wiki/ModelOrganization'>Organization of a model
</a></li>
<li><a href='/wiki/BasicProgrammingConceptsInGAML'>Basic programming concepts in GAML
</a></li>
</ul>
<li><a href='/wiki/ManipulateBasicSpecies'>Manipulate basic species
</a></li>
<ul class='sub'>
<li><a href='/wiki/GlobalSpecies'>The global species
</a></li>
<li><a href='/wiki/RegularSpecies'>Regular species
</a></li>
<li><a href='/wiki/DefiningActionsAndBehaviors'>Defining actions and behaviors
</a></li>
<li><a href='/wiki/InteractionBetweenAgents'>Interaction between agents
</a></li>
<li><a href='/wiki/AttachingSkills'>Attaching Skills
</a></li>
<li><a href='/wiki/Inheritance'>Inheritance
</a></li>
</ul>
<li><a href='/wiki/DefiningAdvancedSpecies'>Defining advanced species
</a></li>
<ul class='sub'>
<li><a href='/wiki/GridSpecies'>Grid Species
</a></li>
<li><a href='/wiki/GraphSpecies'>Graph Species
</a></li>
<li><a href='/wiki/MirrorSpecies'>Mirror species
</a></li>
<li><a href='/wiki/MultiLevelArchitecture'>Multi-level architecture
</a></li>
</ul>
<li><a href='/wiki/DefiningGUIExperiment'>Defining GUI Experiment
</a></li>
<ul class='sub'>
<li><a href='/wiki/DefiningParameters'>Defining Parameters
</a></li>
<li><a href='/wiki/DefiningDisplaysGeneralities'>Defining displays (Generalities)
</a></li>
<li><a href='/wiki/DefiningCharts'>Defining Charts
</a></li>
<li><a href='/wiki/Defining3DDisplays'>Defining 3D Displays
</a></li>
<li><a href='/wiki/DefiningMonitorsAndInspectors'>Defining monitors and inspectors
</a></li>
<li><a href='/wiki/DefiningExportFiles'>Defining export files
</a></li>
<li><a href='/wiki/DefiningUserInteraction'>Defining user interaction
</a></li>
</ul>
<li><a href='/wiki/ExploringModels'>Exploring Models
</a></li>
<ul class='sub'>
<li><a href='/wiki/RunSeveralSimulations'>Run Several Simulations
</a></li>
<li><a href='/wiki/BatchExperiments'>Defining Batch Experiments
</a></li>
<li><a href='/wiki/ExplorationMethods'>Exploration Methods
</a></li>
</ul>
<li><a href='/wiki/OptimizingModels'>Optimizing Models
</a></li>
<ul class='sub'>
<li><a href='/wiki/RuntimeConcepts'>Runtime Concepts
</a></li>
<li><a href='/wiki/OptimizingModels'>Optimizing Models
</a></li>
</ul>
<li><a href='/wiki/MultiParadigmModeling'>Multi-Paradigm Modeling
</a></li>
<ul class='sub'>
<li><a href='/wiki/ControlArchitecture'>Control Architectures
</a></li>
<li><a href='/wiki/Equations'>Using Equations
</a></li>
</ul>
</ul>
<li><a href='/wiki/Recipes'>Recipes
</a></li>
<ul class='sub'>
<li><a href='/wiki/ManipulateOSMDatas'>Manipulate OSM Datas
</a></li>
<li><a href='/wiki/Diffusion'>Implementing diffusion
</a></li>
<li><a href='/wiki/UsingDatabase'>Using Database Access
</a></li>
<li><a href='/wiki/CallingR'>Calling R
</a></li>
<li><a href='/wiki/UsingFIPAACL'>Using FIPA ACL
</a></li>
<li><a href='/wiki/GamAnalyzer'>Using GAMAnalyzer
</a></li>
<li><a href='/wiki/UsingBDI'>Using BDI
</a></li>
<li><a href='/wiki/UsingDrivingSkill'>Advanced Driving Skill
</a></li>
<li><a href='/wiki/ManipulateDates'>Manipulate Dates
</a></li>
<li><a href='/wiki/ManipulateLight'>Implementing light
</a></li>
<li><a href='/wiki/Comodel'>Using Comodel
</a></li>
</ul>
<li><a href='/wiki/Tutorials'>Tutorials
</a></li>
<ul class='sub'>
<li><a href='/wiki/LuneraysFlu'>Luneray's flu
</a></li>
<ul class='sub'>
<li><a href='/wiki/LuneraysFlu_step1'>1. Creation of a first basic disease spreading model
</a></li>
<li><a href='/wiki/LuneraysFlu_step2'>2. Definition of monitors and chart outputs
</a></li>
<li><a href='/wiki/LuneraysFlu_step3'>3. Importation of GIS data
</a></li>
<li><a href='/wiki/LuneraysFlu_step4'>4. Use of a graph to constraint the movements of people]
</a></li>
<li><a href='/wiki/LuneraysFlu_step5'>5. Definition of 3D displays
</a></li>
</ul>
<li><a href='/wiki/IncrementalModel'>Incremental Model
</a></li>
<ul class='sub'>
<li><a href='/wiki/IncrementalModel_step1'>1. Simple SI Model
</a></li>
<li><a href='/wiki/IncrementalModel_step2'>2. Charts
</a></li>
<li><a href='/wiki/IncrementalModel_step3'>3. Integration of GIS Data
</a></li>
<li><a href='/wiki/IncrementalModel_step4'>4. Movement on Graph
</a></li>
<li><a href='/wiki/IncrementalModel_step5'>5. Visualizing in 3D
</a></li>
<li><a href='/wiki/IncrementalModel_step6'>6. Multi-Level
</a></li>
<li><a href='/wiki/IncrementalModel_step7'>7. Differential Equations
</a></li>
</ul>
<li><a href='/wiki/PredatorPrey'>Predator Prey
</a></li>
<ul class='sub'>
<li><a href='/wiki/PredatorPrey_step1'>1. Basic Model
</a></li>
<li><a href='/wiki/PredatorPrey_step2'>2. Vegetation Dynamic
</a></li>
<li><a href='/wiki/PredatorPrey_step3'>3. Prey Agent Behavior
</a></li>
<li><a href='/wiki/PredatorPrey_step4'>4. Inspectors and Monitors
</a></li>
<li><a href='/wiki/PredatorPrey_step5'>5. Predator Agent
</a></li>
<li><a href='/wiki/PredatorPrey_step6'>6. Breeding
</a></li>
<li><a href='/wiki/PredatorPrey_step7'>7. Agent Aspect
</a></li>
<li><a href='/wiki/PredatorPrey_step8'>8. Complex Behavior
</a></li>
<li><a href='/wiki/PredatorPrey_step9'>9. Stopping condition
</a></li>
<li><a href='/wiki/PredatorPrey_step10'>10. Charts
</a></li>
<li><a href='/wiki/PredatorPrey_step11'>11. Writing Files
</a></li>
<li><a href='/wiki/PredatorPrey_step12'>12. Image loading
</a></li>
</ul>
<li><a href='/wiki/RoadTrafficModel'>Road Traffic
</a></li>
<ul class='sub'>
<li><a href='/wiki/RoadTrafficModel_step1'>1. Loading of GIS Data
</a></li>
<li><a href='/wiki/RoadTrafficModel_step2'>2. People Agents
</a></li>
<li><a href='/wiki/RoadTrafficModel_step3'>3. Movement of People
</a></li>
<li><a href='/wiki/RoadTrafficModel_step4'>4. Weight for Road Network
</a></li>
<li><a href='/wiki/RoadTrafficModel_step5'>5. Dynamic weights
</a></li>
<li><a href='/wiki/RoadTrafficModel_step6'>6. Charts
</a></li>
<li><a href='/wiki/RoadTrafficModel_step7'>7. Automatic Road Repair
</a></li>
</ul>
<li><a href='/wiki/ThreeD'>3D Tutorial
</a></li>
<ul class='sub'>
<li><a href='/wiki/ThreeD_step1'>1. Basic Model
</a></li>
<li><a href='/wiki/ThreeD_step2'>2. Moving Cells
</a></li>
<li><a href='/wiki/ThreeD_step3'>3. Connections
</a></li>
</ul>
</ul>
</ul>
<li><a href='/wiki/References'>References
</a></li>
<ul class='sub'>
<li><a href='/wiki/PlatformDocumentation'>Platform
</a></li>
<ul class='sub'>
<li><a href='/wiki/InstallationAndLaunching'>Installation and Launching
</a></li>
<ul class='sub'>
<li><a href='/wiki/Installation'>Installation
</a></li>
<li><a href='/wiki/Launching'>Launching GAMA
</a></li>
<li><a href='/wiki/Headless'>Headless Mode
</a></li>
<li><a href='/wiki/Updating'>Updating GAMA
</a></li>
<li><a href='/wiki/InstallingPlugins'>Installing Plugins
</a></li>
<li><a href='/wiki/Troubleshooting'>Troubleshooting
</a></li>
</ul>
<li><a href='/wiki/WorkspaceProjectsAndModels'>Workspace, Projects and Models
</a></li>
<ul class='sub'>
<li><a href='/wiki/NavigatingWorkspace'>Navigating in the Workspace
</a></li>
<li><a href='/wiki/ChangingWorkspace'>Changing Workspace
</a></li>
<li><a href='/wiki/ImportingModels'>Importing Models
</a></li>
</ul>
<li><a href='/wiki/EditingModels'>Editing models
</a></li>
<ul class='sub'>
<li><a href='/wiki/GamlEditorGeneralities'>The GAML Editor - Generalities
</a></li>
<li><a href='/wiki/GamlEditorToolbar'>The GAML Editor Toolbar
</a></li>
<li><a href='/wiki/ValidationOfModels'>Validation of Models
</a></li>
</ul>
<li><a href='/wiki/RunningExperiments'>Running Experiments
</a></li>
<ul class='sub'>
<li><a href='/wiki/LaunchingExperiments'>Launching Experiments from the User Interface
</a></li>
<li><a href='/wiki/ExperimentsUserInterface'>Experiments User Interface
</a></li>
<li><a href='/wiki/MenusAndCommands'>Menus and Commands
</a></li>
<li><a href='/wiki/ParametersView'>Parameters View
</a></li>
<li><a href='/wiki/InspectorsAndMonitors'>Inspectors and monitors
</a></li>
<li><a href='/wiki/Displays'>Displays
</a></li>
<li><a href='/wiki/BatchSpecific'>Batch Specific UI
</a></li>
<li><a href='/wiki/ErrorsView'>Errors View
</a></li>
</ul>
<li><a href='/wiki/Preferences'>Preferences
</a></li>
</ul>
<li><a href='/wiki/GamlReferences'>Gaml Reference
</a></li>
<ul class='sub'>
<li><a href='/wiki/BuiltInSpecies'>Built-in Species
</a></li>
<ul class='sub'>
<li><a href='/wiki/AgentBuiltIn'>The 'agent' built-in species (Under Construction)
</a></li>
<li><a href='/wiki/ModelBuiltIn'>The 'model' built-in species (Under Construction)
</a></li>
<li><a href='/wiki/ExperimentBuiltIn'>The 'experiment' built-in species (Under Construction)
</a></li>
</ul>
<li><a href='/wiki/BuiltInSkills'>Built-in Skills
</a></li>
<li><a href='/wiki/BuiltInArchitectures'>Built-in Architectures
</a></li>
<li><a href='/wiki/Statements'>Statements
</a></li>
<li><a href='/wiki/DataTypes'>Types
</a></li>
<li><a href='/wiki/FileTypes'>File Types
</a></li>
<li><a href='/wiki/Expressions'>Expressions
</a></li>
<ul class='sub'>
<li><a href='/wiki/Literals'>Literals
</a></li>
<li><a href='/wiki/UnitsAndConstants'>Units and constants
</a></li>
<li><a href='/wiki/PseudoVariables'>Pseudo-variables
</a></li>
<li><a href='/wiki/VariablesAndAttributes'>Variables and Attributes
</a></li>
<li><a href='/wiki/Operators'>Operators 
</a></li>
</ul>
</ul>
</ul>
<li>Community
</li>
<ul class='sub'>
<li><a href='/wiki/Contribute'>Contribute
</a></li>
<li><a href='/wiki/Projects'>Projects
</a></li>
<li><a href='/wiki/TrainingSession'>Training Session
</a></li>
</ul></ul></div><div id="right">
<h3>Facebook Activities</h3>
<ul id="fbquotes">
</ul>
<h3>Commit Activities</h3>
<ul id="commitquotes">
</ul>
<h3>Issue Activities</h3>
<ul id="issuequotes">
</ul>
<h3>Gama Platform Users Activities</h3>
<ul id="googleusersquotes">
</ul>
</div><div id="content"><h1 id="trafic-group-r2d2-maps7---lwr-model">Trafic Group (R2D2) MAPS7 - LWR Model</h1>

<p><em>Author : A. Banos, N. Corson, C. Pivano, L. Rajaonarivo, P. Taillandier</em></p>

<p>The LWR model was proposed by Lighthill and Whitham (1955) and by Richards (1956). It describes the trafic at a global level considering the speed, concentration and flows without taking into account the individual behavior af vehicles. Speed, concentration and flow are the three components of the LWR model. This models reproduces flow of traffic and congestion in specific conditions (homogeneous traffic), going from one equilibrium state to another (see the fundamental diagramm of traffic, which gives flow according to concentration).
In this model, a road is divided into sections and we arbitrarily give to the middle section a lower speed and critical concentration.</p>

<p>Code of the model :</p>

<div class="highlighter-rouge"><pre class="highlight"><code>

model TraficGroup

global {
		
	float road_size &lt;- 10 #km ; 						// Size of the road
	
	geometry shape &lt;- rectangle (road_size, 200 #m) ; 	// The world is a rectangle with a length equals to the size of the road and a height of 200m
		
	float time_step &lt;- 1.0 ; 							// Time step 
	int nb_sections &lt;- 10 ; 							// Number of sections of the road
	float section_size &lt;- road_size / nb_sections ; 	// Size of a section
	
	float car_size &lt;- 4 #m ;									// Size of a car
	float nb_max_cars_on_section &lt;- section_size / car_size ;	// Maximum number of cars on one section 
	
	   init{
	   		
	   		// Creation of the nb_sections sections which compose the road. 
	   		
		   loop i from: 0 to: (nb_sections - 1){
		   	  create section with: [shape:: line([{i * section_size , 100},{(i +1) * section_size , 100}])];
		   }
		   	
		   	// For each section, as we need to have information concerning the previous and the next one, we define which section is the previous and which is the next.
		   	// The previous section is the one which last point corresponds to the first point of the actual section. 
		   	// The next section is the one which first point corresponds to the last point of the actual section. 
		   	
	    	ask section{
	    		previous &lt;- section first_with (last(each.shape.points) = first(self.shape.points)) ;
	    		next &lt;- section first_with (first(each.shape.points) = last(self.shape.points)) ;
	    	}
	
	    	// For each section, we define a critical concentration (see the fundamental diagram), a maximum speed, a concentration and a flow (which are = 0 at initialization). 
	    	// A fundamental relation about trafic gives : flow = concentration * speed.
	    	
	    	ask section{
	    		critical_concentration &lt;- 125.0 ; //Kc
				max_speed &lt;- 50 #km/#h; // Vl
				current_concentration &lt;- 0.0 ;
				current_flow &lt;- current_concentration * max_speed ;
				max_flow &lt;- critical_concentration * max_speed ; 
	    	}
	    		    	
	    	// The concentration and flow ot first section are initialized.
	    	
	    	ask section[0]{
	    		current_concentration &lt;- nb_max_cars_on_section ;
				current_flow &lt;- current_concentration * max_speed ;
	    	}
	    	
	    	// The middle section is supposed to have a different maximum speed and a different critical concentration so that we can observe congestion phenomenon.
	    	// This middle section is green.
	    	
	    	ask section[int(nb_sections/2)] {
	    			critical_concentration &lt;- 10.0 ; 
	    			max_flow &lt;- critical_concentration * max_speed ; 
				    max_speed &lt;- 10 #km/#h; 
					color &lt;- #green;
	    	}
    	}
    	
   // To update flow and concentration at each time step in each section, we use an offer and a demand function. 
   // These functions define the welcome capacity (offer) and the emission capacity (demand) of a section.
   
    reflex offer_function {
	     ask section {
			  if current_concentration &lt;= critical_concentration {
			  	offer &lt;- max_flow ;
			  }
			  else {
			  	offer &lt;- max([0 , (- max_flow / critical_concentration) * current_concentration + 2 * max_flow ]);
			  }
		  
	  }
	}
	
	reflex demand_function {
		ask section{
			  if current_concentration &lt;= critical_concentration {
			  		demand &lt;- max([0 , ( max_flow / critical_concentration) * current_concentration]) ;
			  }
			  else {
			  		demand &lt;- max_flow ;
			  }
		}
	}
	
	// The flow and concentration are then updated according to the offer and demand functions of the current section, but also of the next and previous ones.
	
	// During a time step, the flow of a section take the minimum value between its demand and the offer of the next section.
	// The flow of the last section is equal to its demand.	
	
	reflex update_flow{
		ask section  {
			float next_offer &lt;-  (self.next != nil) ? (self.next).offer : self.demand;
			current_flow &lt;- min([self.demand, next_offer]);
		}
	}
	
	
	// After a time step, the concentration is updated from the current concentration, according to the incoming and outgoing concentrations.
	// The first section concentration on ly takes into account the outgoing concentration of vehicles.
	
	reflex update_concentration{
		ask section   {
			float previous_flow &lt;- (self.previous != nil) ? (self.previous).current_flow : 0.0;
			current_concentration &lt;- current_concentration + time_step/section_size *(previous_flow - self.current_flow) ;
		}	
	}
	
	// When there is less than one car left on the road, the simulation stops.
	
	reflex stop_simulation when: sum(section collect each.current_concentration) &lt; 1.0 {
		do pause;
	}
}

// A road is divided into sections. 
// Each section has a concentration, a flow, an offer and a demand, a critical concentration, a maximum speed and a maximum flow, 
// and a previous and a next section.

species section {
	float current_concentration  ;
	float current_flow  ;
	
	float offer ;
	float demand  ;
	
	rgb color;
	
	float critical_concentration ; 
	float max_speed ; 
	float max_flow ; 

	section previous ;
	section next ;
	
	// The width of a section depends on its concentration.
	
	aspect shape_section {
		draw shape + (1 + 15 * ln (current_concentration + 1)) color: color;		
	} 

}


experiment TraficGroup type: gui {

	// Users can chose the number of sections and the time step.

    parameter 'Number of sections' var: nb_sections category: "Section parameter";
    parameter 'Time step - DeltaT' var: time_step category: "Time parameter";
        
	output {
		
		// A monitor gives the number of cars on the road at every time step.
		
		monitor "Sum Concentrations" value: sum(section collect each.current_concentration);
		
		// A display shows the road. Section width depend on their concentration.
		
		display TheRoad{
			species section aspect: shape_section ;
		}
		
		// The greeen time series correspond to the middle section (on which concentration and maximum speed are lower).
		// The red time series correspond to the section just before the middle one.
				
		display Concentrations {
			chart "Concentrations" type: series  {
				data 'Section 0' value: section[0].current_concentration color: #gray marker: false ;				
				data 'Section 1' value: section[1].current_concentration color: #gray marker: false;
				data 'Section 2' value: section[2].current_concentration color: #gray marker: false;
				data 'Section 3' value: section[3].current_concentration color: #gray marker: false;				
				data 'Section 4' value: section[int(nb_sections/2 - 1 ) ].current_concentration color: #red marker: false;
				data 'Section 5' value: section[int(nb_sections/2)].current_concentration color: #green marker: false;
				data 'Section 6' value: section[6].current_concentration color: #gray marker: false;				
				data 'Section 7' value: section[7].current_concentration color: #gray marker: false;
				data 'Section 8' value: section[8].current_concentration color: #gray marker: false;
				data 'Section 9' value: section[9].current_concentration color: #gray marker: false;
				}
			}
			
			display Flows {
			    chart "Flows" type: series  {
				data 'Section 0' value: section[0].current_flow color: #gray marker: false;				
				data 'Section 1' value: section[1].current_flow color: #gray marker: false;
				data 'Section 2' value: section[2].current_flow color: #gray marker: false;
				data 'Section 3' value: section[3].current_flow color: #gray marker: false;				
				data 'Section 4' value: section[int(nb_sections/2 - 1)].current_flow color: #red marker: false;
				data 'Section 5' value: section[int(nb_sections/2)].current_flow color: #green marker: false;
				data 'Section 6' value: section[6].current_flow color: #gray marker: false;				
				data 'Section 7' value: section[7].current_flow color: #gray marker: false;
				data 'Section 8' value: section[8].current_flow color: #gray marker: false;
				data 'Section 9' value: section[9].current_flow color: #gray marker: false;
				}
			}
	}
}
</code></pre>
</div>
</div></body></html>
